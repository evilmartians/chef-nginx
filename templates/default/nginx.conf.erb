# This file is generated and managed by Chef. It will be overwritten on the
# next chef_run. Please, be careful!

user <%= node['nginx']['user'] %>;
worker_processes  <%= node['nginx']['worker_processes'] %>;
<% if node['nginx']['daemon_disable'] -%>
daemon off;
<% end -%>

error_log  <%= node['nginx']['directories']['log_dir'] %>/error.log;
pid        /var/run/nginx.pid;

events {
  worker_connections  <%= node['nginx']['worker_connections'] %>;
}

worker_rlimit_nofile <%= node['nginx']['worker_rlimit_nofile'] %>;

http {
  include       <%= node['nginx']['directories']['conf_dir'] %>/mime.types;
  default_type  application/octet-stream;

  log_format detailed '$remote_addr - $remote_user [$time_local] $host '
                        '"$request" $status $body_bytes_sent '
                        '"$http_referer" "$http_user_agent" "$http_x_forwarded_for" '
                        '$pid $connection $request_time $msec '
                        '$upstream_status $upstream_response_time';

  access_log	<%= node['nginx']['directories']['log_dir'] %>/access.log detailed;

  sendfile on;
  tcp_nopush on;
  tcp_nodelay on;
  server_tokens off;
  reset_timedout_connection <%= node['nginx']['reset_timedout_connection'] %>;

  <% if node['nginx']['keepalive'] == "on" %>
  keepalive_timeout  <%= node['nginx']['keepalive_timeout'] %>;
  <% end %>

  gzip  <%= node['nginx']['gzip']['enable'] %>;
  <% if node['nginx']['gzip']['enable'] == "on" %>
  gzip_http_version <%= node['nginx']['gzip']['gzip_http_version'] %>;
  gzip_comp_level <%= node['nginx']['gzip']['gzip_comp_level'] %>;
  gzip_proxied <%= node['nginx']['gzip']['gzip_proxied'] %>;
  gzip_types <%= node['nginx']['gzip']['gzip_types'].join(' ') %>;
  gzip_disable <%= node['nginx']['gzip']['gzip_disable'] %>;
  gzip_vary <%= node['nginx']['gzip']['gzip_vary'] %>;
  <% end %>

  server_names_hash_bucket_size <%= node['nginx']['server_names_hash_bucket_size'] %>;
  types_hash_bucket_size <%= node['nginx']['types_hash_bucket_size'] %>;

  include <%= node['nginx']['directories']['conf_dir'] %>/conf.d/*.conf;
  include <%= node['nginx']['directories']['conf_dir'] %>/sites-enabled/*;
}
